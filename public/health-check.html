<!DOCTYPE html>
<html>
<head>
    <title>Health Check</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status { padding: 15px; border-radius: 5px; margin: 20px 0; }
        .success { background: #d4edda; border-left: 4px solid #28a745; color: #155724; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; color: #721c24; }
        .info { background: #d1ecf1; border-left: 4px solid #007bff; color: #0c5460; }
        h1 { color: #333; }
        .test-button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 10px 5px; }
        .test-button:hover { background: #0056b3; }
        .result { margin-top: 10px; padding: 15px; background: #f8f9fa; border-radius: 5px; display: none; }
        .loading { display: none; color: #007bff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Shopify App Health Check</h1>
        
        <div class="status info">
            <strong>Info:</strong> This page helps verify that your Shopify app is properly deployed and functioning.
        </div>
        
        <h2>Basic Connectivity Tests</h2>
        <button class="test-button" onclick="testRoot()">Test Root Endpoint</button>
        <button class="test-button" onclick="testHealth()">Test Health Endpoint</button>
        <div id="rootResult" class="result"></div>
        <div id="healthResult" class="result"></div>
        
        <h2>API Endpoint Tests</h2>
        <p>Enter a product handle to test API endpoints:</p>
        <input type="text" id="productHandle" placeholder="Enter product handle" value="classic-cotton-t-shirt" style="width: 300px; padding: 8px;">
        <button class="test-button" onclick="testProductDetails()">Test Product Details</button>
        <button class="test-button" onclick="testProductVariants()">Test Product Variants</button>
        <button class="test-button" onclick="testCustomerDesigns()">Test Customer Designs</button>
        <div id="productDetailsResult" class="result"></div>
        <div id="productVariantsResult" class="result"></div>
        <div id="customerDesignsResult" class="result"></div>
        
        <div id="loading" class="loading">Testing... Please wait</div>
    </div>

    <script>
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }
        
        function showResult(elementId, success, message, data = null) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'result ' + (success ? 'success' : 'error');
            element.innerHTML = '<strong>' + (success ? 'Success' : 'Error') + ':</strong> ' + message;
            if (data) {
                element.innerHTML += '<pre style="margin-top: 10px; white-space: pre-wrap; background: #fff; padding: 10px; border-radius: 4px;">' + JSON.stringify(data, null, 2) + '</pre>';
            }
        }

        async function testRoot() {
            showLoading(true);
            try {
                const response = await fetch('/');
                showResult('rootResult', response.ok, `Status: ${response.status} - ${response.ok ? 'OK' : 'Error'}`);
            } catch (error) {
                showResult('rootResult', false, `Error: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }

        async function testHealth() {
            showLoading(true);
            try {
                // Since there's no specific health endpoint, we'll test the root
                const response = await fetch('/');
                showResult('healthResult', response.ok, `Status: ${response.status} - ${response.ok ? 'OK' : 'Error'}`);
            } catch (error) {
                showResult('healthResult', false, `Error: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }

        async function testProductDetails() {
            const productHandle = document.getElementById('productHandle').value;
            if (!productHandle) {
                alert('Please enter a product handle');
                return;
            }
            
            showLoading(true);
            try {
                const response = await fetch(`/api/products/details?productId=HANDLE-${encodeURIComponent(productHandle)}`);
                const data = await response.json();
                showResult('productDetailsResult', response.ok, `Status: ${response.status}`, data);
            } catch (error) {
                showResult('productDetailsResult', false, `Error: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }

        async function testProductVariants() {
            const productHandle = document.getElementById('productHandle').value;
            if (!productHandle) {
                alert('Please enter a product handle');
                return;
            }
            
            showLoading(true);
            try {
                const response = await fetch(`/api/products/variants?productId=HANDLE-${encodeURIComponent(productHandle)}`);
                const data = await response.json();
                showResult('productVariantsResult', response.ok, `Status: ${response.status}`, data);
            } catch (error) {
                showResult('productVariantsResult', false, `Error: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }

        async function testCustomerDesigns() {
            showLoading(true);
            try {
                const response = await fetch('/api/customer-designs');
                const data = await response.json();
                showResult('customerDesignsResult', response.ok, `Status: ${response.status}`, data);
            } catch (error) {
                showResult('customerDesignsResult', false, `Error: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }
    </script>
</body>
</html>